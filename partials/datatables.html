<!-- DataTables assets -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>

<style>
/* linksbündig + volle Breite */
.datatable table, .datatable-nosearch table { width: 100% !important; }
.datatable table td, .datatable table th,
.datatable-nosearch table td, .datatable-nosearch table th { text-align: left; }

/* etwas Luft unter dem Suchfeld (nur .datatable mit Suche) */
.datatable .dataTables_filter { margin-bottom: 1.5rem; }
</style>

<script>
(function () {
  function initDT() {
    if (!window.jQuery || !jQuery.fn || !jQuery.fn.DataTable) return;

    // 0) Vorhandene Instanzen zerstören (Hot-Reload zuverlässig)
    document.querySelectorAll('.datatable table, .datatable-nosearch table').forEach(function (tbl) {
      if (jQuery.fn.dataTable.isDataTable(tbl)) {
        try { jQuery(tbl).DataTable().destroy(); } catch(e) {}
      }
      tbl.removeAttribute('data-dt-inited');
      tbl.classList.remove('dataTable');
    });

    // 1) Tabellen MIT Suche (globales Glossar)
    document.querySelectorAll('.datatable table').forEach(function (tbl) {
      if (tbl.dataset.dtInited === '1') return;
      const wrap = tbl.closest('.datatable');
      let order = [[0,'asc']];
      try {
        const o = wrap && wrap.getAttribute('data-order');
        if (o) order = JSON.parse(o);
      } catch(e) {}
      jQuery(tbl).DataTable({
        dom: 'f',
        paging: false,
        info: false,
        ordering: true,
        order: order
      });
      tbl.dataset.dtInited = '1';
    });

    // 2) Tabellen OHNE Suche (Kapitel-Glossare)
    document.querySelectorAll('.datatable-nosearch table').forEach(function (tbl) {
      if (tbl.dataset.dtInited === '1') return;
      const wrap = tbl.closest('.datatable-nosearch');
      let order = [[0,'asc']]; // Fallback
      try {
        const o = wrap && wrap.getAttribute('data-order');
        if (o) order = JSON.parse(o);   // <-- liest z.B. [[2,"asc"]]
      } catch(e) {}
      jQuery(tbl).DataTable({
        dom: 't',        // nur Tabelle
        paging: false,
        info: false,
        ordering: true,
        order: order,
        orderMulti: false
      });
      tbl.dataset.dtInited = '1';
    });
  }
  document.addEventListener('DOMContentLoaded', initDT);
  document.addEventListener('quarto:rendered', initDT);
})();
</script>
